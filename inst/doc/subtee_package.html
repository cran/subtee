<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="date" content="2019-01-07" />

<title>Introduction to subtee and Usage Instructions</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Introduction to subtee and Usage Instructions</h1>
<h4 class="date"><em>2019-01-07</em></h4>



<p>In this vignette we showcase the estimation functions of the <code>subtee</code> package. We provide three ways for estimating the treatment effects in subgroups: unadjusted estimation (<code>unadj</code>), model averaging (<code>modav</code>), and using bootstrap bias adjustment (<code>bagged</code>).</p>
<div id="analyzing-the-data" class="section level2">
<h2>Analyzing the data</h2>
<p>We use the prostate cancer dataset that was used in Rosenkranz (2016) to illustrate the usage of the package. The dataset consists of n=475 subjects randomized to a control group or diethylstilbestrol. The considered endpoint is survival time in months. There are six subgroup defining variables to consider: existence of bone metastasis (BM), disease stage (3 or 4), performance (PF), history of cardiovascular events (HX), age, and weight. While age and weight are continuous covariates, they are dichotomized (age <span class="math inline">\(\leq\)</span> 65, <span class="math inline">\(&gt;\)</span> 65 and weight <span class="math inline">\(\leq\)</span> 100, <span class="math inline">\(&gt;\)</span> 100) for obtaining subgroups as in Rosenkranz (2016).</p>
<p>The considered endpoint is survival time in months and Cox proportional hazards models are fitted. We first start producing the treatment effect estimates for all subgroups, using the <code>unadj</code>, <code>modav</code> and <code>bagged</code> functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(subtee)
################################################################################
<span class="co"># We use the dataset from Rosenkranz (2016) https://onlinelibrary.wiley.com/doi/abs/10.1002/bimj.201500147</span>
<span class="co"># to illustrate the methods proposed in this work.</span>
<span class="co"># The data comes from a clinical trial of an prostate cancer treatment</span>
<span class="co"># Data is loaded from Royston, Patrick, and Willi Sauerbrei. Multivariable model-building: a pragmatic approach to regression anaylsis based on fractional polynomials for modelling continuous variables. Vol. 777. John Wiley &amp; Sons, 2008. https://www.imbi.uni-freiburg.de/Royston-Sauerbrei-book</span>
data_url =<span class="st"> &quot;https://www.imbi.uni-freiburg.de/imbi/Royston-Sauerbrei-book/Multivariable_Model-building/downloads/datasets/adv_prostate_ca.zip&quot;</span>
temp &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
<span class="kw">download.file</span>(data_url, temp, <span class="dt">cacheOK =</span> <span class="ot">FALSE</span>)
prca =<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">unz</span>(temp, <span class="st">&quot;adv_prostate_ca/adv_prostate_ca.csv&quot;</span>))
<span class="kw">names</span>(prca) =<span class="st"> </span><span class="kw">toupper</span>(<span class="kw">names</span>(prca))</code></pre></div>
</div>
<div id="subbuild-function" class="section level2">
<h2><code>subbuild</code> function</h2>
<p>We first use the <code>subbuild</code> function to create the subgroup defining binary covariates. This function takes the dataset as a first argument, and then a series of expressions to define the subgroup indicator variables (see ?subbuild for more options on how to generate binary subgroup indicators based on a data-set). Note that we also use the option dupl.rm = TRUE to remove duplicate subgroups. The output of the <code>subbuild</code> is a data.frame that might then be concatenated with the original dataset to be used in the other functions. This step can be ommited if the original dataset already contains the subgroup defining indicator variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cand.groups &lt;-<span class="st"> </span><span class="kw">subbuild</span>(prca, <span class="dt">dupl.rm =</span> <span class="ot">TRUE</span>,
                        BM <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, PF <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, HX <span class="op">==</span><span class="st"> </span><span class="dv">1</span>,
                        STAGE <span class="op">==</span><span class="st"> </span><span class="dv">4</span>, AGE <span class="op">&gt;</span><span class="st"> </span><span class="dv">65</span>, WT <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>)
<span class="kw">head</span>(cand.groups)
<span class="co">#&gt;   BM == 1 PF == 1 HX == 1 STAGE == 4 AGE &gt; 65 WT &gt; 100</span>
<span class="co">#&gt; 1       0       0       0          0        1        0</span>
<span class="co">#&gt; 2       0       0       1          0        1        1</span>
<span class="co">#&gt; 3       0       1       1          0        1        0</span>
<span class="co">#&gt; 4       0       0       0          0        1        0</span>
<span class="co">#&gt; 5       0       0       0          0        1        0</span>
<span class="co">#&gt; 6       0       0       0          0        1        0</span>
fitdat &lt;-<span class="st"> </span><span class="kw">cbind</span>(prca, cand.groups)
subgr.names &lt;-<span class="st"> </span><span class="kw">names</span>(cand.groups)
prog &lt;-<span class="st"> </span><span class="kw">as.formula</span>(<span class="kw">paste</span>(<span class="st">&quot; ~ &quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;`&quot;</span>, <span class="kw">names</span>(cand.groups),<span class="st">&quot;`&quot;</span>, <span class="dt">collapse =</span> <span class="st">&quot; + &quot;</span>)))</code></pre></div>
<p>Before investigating how the treatment effect differs across the subgroups we first fit the overall model, adjusting for the subgroup indicators only as prognostic covariates. Since we have survival endpoint, we use <code>coxph</code> from the <code>survival</code> package as fitting function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survival)
form &lt;-<span class="st"> </span><span class="kw">as.formula</span>(<span class="kw">paste</span>(<span class="st">&quot;Surv(SURVTIME,CENS) ~ RX +&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;`&quot;</span>, <span class="kw">names</span>(cand.groups),<span class="st">&quot;`&quot;</span>, <span class="dt">collapse =</span> <span class="st">&quot; + &quot;</span>)))
<span class="kw">coxph</span>(form, <span class="dt">data=</span>fitdat, <span class="dt">ties =</span> <span class="st">&quot;breslow&quot;</span>)
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; coxph(formula = form, data = fitdat, ties = &quot;breslow&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                coef exp(coef) se(coef)     z      p</span>
<span class="co">#&gt; RX           -0.183     0.832    0.113 -1.62 0.1043</span>
<span class="co">#&gt; `BM == 1`     0.478     1.612    0.171  2.79 0.0053</span>
<span class="co">#&gt; `PF == 1`     0.437     1.548    0.173  2.52 0.0118</span>
<span class="co">#&gt; `HX == 1`     0.437     1.549    0.112  3.89  1e-04</span>
<span class="co">#&gt; `STAGE == 4`  0.205     1.228    0.129  1.59 0.1125</span>
<span class="co">#&gt; `AGE &gt; 65`    0.259     1.295    0.152  1.70 0.0898</span>
<span class="co">#&gt; `WT &gt; 100`   -0.199     0.820    0.114 -1.74 0.0810</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Likelihood ratio test=56.9  on 7 df, p=6.29e-10</span>
<span class="co">#&gt; n= 475, number of events= 338</span></code></pre></div>
<p>We see that the new treatment leads to better outcomes when compared to control, as the overall treatment effect (RX) is negative. However, its confidence interval covers the no-effect value of 0.</p>
</div>
<div id="unadj-function" class="section level2">
<h2><code>unadj</code> function</h2>
<p>Unadjusted subgroup treatment effect estimates are obtained via the <code>unadj</code> function. We fit the models including the six subgroup indicators as prognostic factors as well, which are added through the <code>covars</code> argument as a formula. The <code>unadj</code> function loops through the <span class="math inline">\(P\)</span> variables specified in the <code>subgr</code> argument, fitting the models</p>
<span class="math display">\[\begin{equation}
M_p:\ \lambda_{pi}(t)= \lambda_{p0}(t) \exp\left\{\beta_p z_i + 
(\gamma_p + \delta_p z_i)s_{pi} +  \sum_{k = 1}^{K} \tau_k x_{ik} \right\}
\label{model.cox}
\end{equation}\]</span>
<p>for <span class="math inline">\(p=1,...,P\)</span>. In this example, we make use of the <code>...</code> option to pass the option <code>ties = &quot;breslow&quot;</code> to <code>coxph</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">### Unadjusted estimates
res_unadj =<span class="st"> </span><span class="kw">unadj</span>(<span class="dt">resp =</span> <span class="st">&quot;SURVTIME&quot;</span>, <span class="dt">trt =</span> <span class="st">&quot;RX&quot;</span>, <span class="dt">subgr =</span> subgr.names,
                  <span class="dt">data =</span> fitdat, <span class="dt">covars =</span> prog, 
                  <span class="dt">event =</span> <span class="st">&quot;CENS&quot;</span>, <span class="dt">fitfunc =</span> <span class="st">&quot;coxph&quot;</span>, <span class="dt">ties =</span> <span class="st">&quot;breslow&quot;</span>)
res_unadj
<span class="co">#&gt; Trt. Effect Estimates</span>
<span class="co">#&gt;         Group     Subset      LB    trtEff       UB</span>
<span class="co">#&gt; 1     BM == 1   Subgroup -1.1949 -0.785335 -0.37579</span>
<span class="co">#&gt; 2     BM == 1 Complement -0.2442 -0.040729  0.16273</span>
<span class="co">#&gt; 3     PF == 1   Subgroup -0.3965  0.118040  0.63257</span>
<span class="co">#&gt; 4     PF == 1 Complement -0.4212 -0.224282 -0.02734</span>
<span class="co">#&gt; 5     HX == 1   Subgroup -0.2547  0.006503  0.26774</span>
<span class="co">#&gt; 6     HX == 1 Complement -0.6199 -0.363698 -0.10754</span>
<span class="co">#&gt; 7  STAGE == 4   Subgroup -0.6526 -0.376238 -0.09986</span>
<span class="co">#&gt; 8  STAGE == 4 Complement -0.2748 -0.027431  0.21998</span>
<span class="co">#&gt; 9    AGE &gt; 65   Subgroup -0.2517 -0.052995  0.14568</span>
<span class="co">#&gt; 10   AGE &gt; 65 Complement -1.4451 -0.962738 -0.48037</span>
<span class="co">#&gt; 11   WT &gt; 100   Subgroup -0.5730 -0.274251  0.02451</span>
<span class="co">#&gt; 12   WT &gt; 100 Complement -0.3622 -0.126989  0.10819</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Difference in Trt. Effect vs Complement</span>
<span class="co">#&gt;        Group        LB trtEffDiff       UB</span>
<span class="co">#&gt; 1    BM == 1 -1.201671    -0.7446 -0.28754</span>
<span class="co">#&gt; 2    PF == 1 -0.203438     0.3423  0.88808</span>
<span class="co">#&gt; 3    HX == 1  0.007603     0.3702  0.73280</span>
<span class="co">#&gt; 4 STAGE == 4 -0.718343    -0.3488  0.02073</span>
<span class="co">#&gt; 5   AGE &gt; 65  0.394367     0.9097  1.42512</span>
<span class="co">#&gt; 6   WT &gt; 100 -0.524689    -0.1473  0.23016</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Subgroup Models fitted with &quot;coxph&quot;</span>
<span class="co">#&gt; Effect estimates in terms of the log-hazard ratios</span></code></pre></div>
<p>The output shows first the treatment effect estimates (trtEff) in the subgroups and corresponding lower and upper bounds of the unadjusted confidence intervals (LB and UB respectively). A second table is then displayed with the information on the difference in treatment effect in subgroups vs. their complements. The treatment effects are on same scale as returned by the linear predictictor of the specified <code>fitfunc</code>. In this example, the treatment effects are expressed in terms of the log-hazard ratios.</p>
<p>Using the unadjusted estimates for subgroups leads to the conclusion that there may be subgroups with differential treatment effect. In particular, patients with bone metastasis and patients younger than 65 may have a differential benefit from the treatment. This is also observed when looking at the interaction effects between these covariates and treatment. These results needs to be interpreted with caution as this is only an exploratory analysis.</p>
</div>
<div id="modav-function" class="section level2">
<h2><code>modAv</code> function</h2>
<p>We use the <code>modAv</code> function to obtain the model averaging estimates. In this case, we use the same options as in the <code>unadj</code> function, so we used the default values to set all the models with equal prior weights and no prior weight for the overall model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">### ModelAveraging estimates
res_modav =<span class="st"> </span><span class="kw">modav</span>(<span class="dt">resp =</span> <span class="st">&quot;SURVTIME&quot;</span>, <span class="dt">trt =</span> <span class="st">&quot;RX&quot;</span>, <span class="dt">subgr =</span> subgr.names,
                  <span class="dt">data =</span> fitdat, <span class="dt">covars =</span> prog, 
                  <span class="dt">event =</span> <span class="st">&quot;CENS&quot;</span>, <span class="dt">fitfunc =</span> <span class="st">&quot;coxph&quot;</span>, <span class="dt">ties =</span> <span class="st">&quot;breslow&quot;</span>)
res_modav
<span class="co">#&gt; Trt. Effect Estimates</span>
<span class="co">#&gt;         Group     Subset      LB  trtEff        UB</span>
<span class="co">#&gt; 1     BM == 1   Subgroup -1.0089 -0.3182 -0.082706</span>
<span class="co">#&gt; 2     BM == 1 Complement -0.3633 -0.1577  0.080986</span>
<span class="co">#&gt; 3     PF == 1   Subgroup -0.4800 -0.2247 -0.006514</span>
<span class="co">#&gt; 4     PF == 1 Complement -0.3813 -0.1889  0.004497</span>
<span class="co">#&gt; 5     HX == 1   Subgroup -0.3421 -0.1533  0.044871</span>
<span class="co">#&gt; 6     HX == 1 Complement -0.4253 -0.2228 -0.029070</span>
<span class="co">#&gt; 7  STAGE == 4   Subgroup -0.4663 -0.2493 -0.048809</span>
<span class="co">#&gt; 8  STAGE == 4 Complement -0.3614 -0.1547  0.086863</span>
<span class="co">#&gt; 9    AGE &gt; 65   Subgroup -0.3016 -0.0915  0.121691</span>
<span class="co">#&gt; 10   AGE &gt; 65 Complement -1.3799 -0.7415 -0.086948</span>
<span class="co">#&gt; 11   WT &gt; 100   Subgroup -0.3732 -0.1769  0.021429</span>
<span class="co">#&gt; 12   WT &gt; 100 Complement -0.3909 -0.2040 -0.016736</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Difference in Trt. Effect vs Complement</span>
<span class="co">#&gt;        Group        LB trtEffDiff       UB</span>
<span class="co">#&gt; 1    BM == 1 -0.994109   -0.08220 -0.02315</span>
<span class="co">#&gt; 2    PF == 1 -0.291039    0.01613  0.03506</span>
<span class="co">#&gt; 3    HX == 1  0.017764    0.06258  0.12345</span>
<span class="co">#&gt; 4 STAGE == 4 -0.386656   -0.03536 -0.01087</span>
<span class="co">#&gt; 5   AGE &gt; 65  0.017744    0.67341  1.35540</span>
<span class="co">#&gt; 6   WT &gt; 100 -0.001293    0.01531  0.09971</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Subgroup Models fitted with &quot;coxph&quot;</span>
<span class="co">#&gt; Effect estimates in terms of the log-hazard ratios</span></code></pre></div>
<p>Model averaging has the effect of shrinking the estimates towards the overall treatment effect. Therefore, it may help in adjusting for potential “random high bias”. In this sense, we observe that the treatment effects for the subgroups <code>BM == 1</code> and <code>Age &lt; 65</code> are closer to the overall treament effect when using model averaging. All confidence intervals for treatment effects in subgroups cover the overall treatment effect.</p>
</div>
<div id="bagged-function" class="section level2">
<h2><code>bagged</code> function</h2>
<p>We obtain the bagged estimates using the <code>bagged</code> function. Note that we should also provide to the function how the subgroup is selected (<code>select.by = &quot;BIC&quot;</code>) and the number of bootstrap to use (<code>B = 2000</code>). We also let the default option <code>stratify = TRUE</code>, which controls that the bootstrap samples have the same number of subjects in treatment and controls arms as the original dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">### Bagged estimates
<span class="kw">set.seed</span>(<span class="dv">321231</span>) <span class="co"># set seed for reproducible results in the bootstrap samples</span>
res_bagged =<span class="st"> </span><span class="kw">bagged</span>(<span class="dt">resp =</span> <span class="st">&quot;SURVTIME&quot;</span>, <span class="dt">trt =</span> <span class="st">&quot;RX&quot;</span>, <span class="dt">subgr =</span> subgr.names,
                    <span class="dt">data =</span> fitdat, <span class="dt">covars =</span> prog, 
                    <span class="dt">event =</span> <span class="st">&quot;CENS&quot;</span>, <span class="dt">fitfunc =</span> <span class="st">&quot;coxph&quot;</span>,
                    <span class="dt">select.by =</span> <span class="st">&quot;BIC&quot;</span>, <span class="dt">B =</span> <span class="dv">200</span>) <span class="co">#B = 2000)</span>
res_bagged
<span class="co">#&gt; Trt. Effect Estimates</span>
<span class="co">#&gt;      Group     Subset      LB  trtEff     UB</span>
<span class="co">#&gt; 1 AGE &gt; 65   Subgroup -0.2914 -0.0763 0.1388</span>
<span class="co">#&gt; 2 AGE &gt; 65 Complement -1.7822 -0.8351 0.1120</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Difference in Trt. Effect vs Complement</span>
<span class="co">#&gt;      Group       LB trtEffDiff    UB</span>
<span class="co">#&gt; 1 AGE &gt; 65 -0.08617     0.7588 1.604</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  AGE &gt; 65 is the selected subgroup.</span>
<span class="co">#&gt;  It was selected in  48.5 % of the bootstrap samples. </span>
<span class="co">#&gt;  See more details in x$boot_results</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Subgroup Models fitted with &quot;coxph&quot;</span>
<span class="co">#&gt; Effect estimates in terms of the log-hazard ratios</span></code></pre></div>
<p>The bootstrap methods provides bias-adjusted estimates, which corrects for the bias that is introduced when selecting a subgroup. Therefore, it only makes sense to display the results of the selected subgroup. The user however may explore the results of the bootstrap samples, which are included in the output object.</p>
<p>The subgroup defined by <code>AGE&gt;65</code> is the most selected in the bootstrap samples. This allows to ‘correct’ the estimates for selection bias. We observe a similar pattern as with model averaging. After using bootstrap, the treatment effect is closer to that on the overall population and its confidence interval even covers it.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
